:doctype: book

'''

slug: controller id: mcu4hbq03v3j type: challenge title: Understanding and using Automation controller teaser: Setup dynamic inventory in automation controller for AWS EC2 notes:

* type: text contents: |-   Please click the Green Start button image:https://github.com/IPvSean/pictures_for_github/blob/master/start_button.png?raw=true[,100px] on the _bottom right corner_ if it did not already start creating the lab environment.
+
+
To begin your lab briefing click the white `>` on the right\->

* type: text contents: |   # Automation controller
+
The control plane for Ansible Automation Platform is the automation controller.+++<center>+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/automation_controller.png?raw=true" width=600px%>+++</center>+++
+
Automation controller helps standardize how automation is deployed, initiated, delegated, and audited, allowing enterprises to automate with confidence while reducing sprawl and variance.
Manage inventory, launch and schedule workflows, track changes, and integrate into reporting, all from a centralized user interface and RESTful API.

* type: text contents: |+   # Inventories
+
An Inventory is a collection of hosts against which automation jobs may be launched, the same as an Ansible inventory file.
Inventories are divided into groups and these groups contain the actual hosts.
Groups may be sourced manually, by entering host names into the automation controller, or from one of its supported cloud providers.
+
# Inventory Plugins
+
There is a variety of pre-built Inventory Plugins that are available:

 ** Amazon Web Services EC2
 ** Google Compute Engine
 ** Microsoft Azure Resource Manager
 ** VMware vCenter

* type: text contents: |-   Example of configuring AWS inventory source:
+
image::https://docs.ansible.com/automation-controller/latest/html/userguide/_images/inventories-create-source-AWS-example.png[picture of AWS inventory]

* type: text contents: |-   # Lab Diagram
+
Here is a diagram of the lab topology.+++<center>+++image:https://github.com/IPvSean/pictures_for_github/blob/master/aws-diagram.png?raw=true[,600px]+++</center>+++
+
There is one automation controller node, and two Red Hat Enterprise Linux nodes running in Amazon Web Services (AWS) Elastic Cloud (EC2).

* type: text contents: |-   # Lets get started
+
That is the end of of your lab briefing!
+
Once the lab is setup you can click the Green start button image:https://github.com/IPvSean/pictures_for_github/blob/master/start_button.png?raw=true[,100px] in the bottom right corner of this window.
tabs:

* id: ghytxtnegpww title: Automation Controller type: service hostname: controller port: 443
* id: bmg0gonmktjg title: AWS console type: service hostname: cloud-client path: / port: 80 difficulty: "" timelimit: 300 enhanced_loading: null -- üëã Introduction ===
+
==== Estimated time to complete: _10 minutes_<p>
+
Welcome to the `Ansible Hybrid Cloud Automation - Infrastructure visibility lab`.
In the following challenges and tasks we will guide you in understanding Infrastructure visibility use case.
In this first challenge, you will learn about setting up a dynamic inventory for AWS EC2 in automation controller.

Login to Ansible Automation Platform UI with the following credentials

[cols=2*]
|===
| username:
| `admin`

| password:
| `ansible123!`
|===

= ‚òëÔ∏è Task 1 - Understanding credentials

Credentials are utilized for authentication when launching Jobs against machines, synchronizing with inventory sources, and importing project content from a version control system.
In this lab, we have two different credentials:

* *RHEL on AWS - SSH KEY* - This is an SSH key for the two Red Hat Enterprise Linux hosts running on AWS
* *AWS_Credential* - This is the AWS credential for performing actions on AWS cloud.
For example, creating a VPC, or shutting down an instance.

In the *Controller* tab at the top of your window click on the *Credentials* link under *Automation Execution \-> Infrastructure \-> Credentials* to examine the two pre-configured credentials.
Login with the admin credentials provided above.

*Note* The keys are encrypted so no one, not even an administrator, can see the key once it has been placed in automation controller.

= ‚òëÔ∏è Task 2 - Creating an Inventory

Click on the *Controller* tab at the top of lab.
Click on the *Inventories* link under the *Automation Execution \-> Infrastructure \-> Inventories* group on the left navigation menu.
Now, click the blue *Create Inventory* button and select *Create Inventory*.

image::https://github.com/HichamMourad/awsinfravis25/blob/master/images/create_inventory.png?raw=true[,600]

Fill out the following fields:+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Name+++</td>++++++<td>+++AWS Inventory+++</td>+++
+++<tr>++++++<td>+++Organization+++</td>++++++<td>+++Default+++</td>+++
</table>

Click the blue **Create Inventory** button to save the inventory.

‚òëÔ∏è Task 3 - Creating an Inventory Source
===

Now that you have created the **AWS Inventory** click on the **Sources** tab at the top of the inventory.

+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/sources-savage.png?raw=true" style="width:300px;margin-left:0px">++++++</img>+++

Now click the blue **Create Source** button.

Fill out the following fields:

+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Name+++</td>++++++<td>+++AWS Source+++</td>+++
+++<tr>++++++<td>+++Source+++</td>++++++<td>+++Amazon EC2+++</td>+++
</table>

Once you select **Amazon EC2** more choices will pop up.  Fill out the following field:

+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Credential+++</td>++++++<td>+++AWS_Credential+++</td>+++
</table>

Click the **drop-down**, then select the **Browse** button Select the **radio button** next to `AWS_Credential`, then click **Confirm**.

Click **Create Source**

Now click **Launch Inventory Update** in the top right to retrieve the inventory from AWS EC2.

‚òëÔ∏è Task 4 - Examine the Inventory
===

For this task we will examine the inventory then run an ad-hoc job.  Click on the **AWS Inventory** link to return to the top-level menu for the AWS Inventory.

+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/aws_inventory_menu.png?raw=true" style="width:400px;margin-left:0px">++++++</img>+++

Now click on **Hosts**.  There will be two hosts listed with their name pre-pended with **ec2**.  These were dynamically pulled from AWS via the Inventory Plugin we just setup.  Click the checkmark next to each host then click the **Run Command** button.  Fill out the following fields:

### **Details**:
+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Module+++</td>++++++<td>+++ping+++</td>+++
</table>

Click **Next**

+++<hr>++++++</hr>+++

### **Execution Environment**:

Select
* **Default execution environment**

Click **Next**

+++<hr>++++++</hr>+++

### **Credential**:

Select
* **RHEL on AWS - SSH KEY** (You may have to select the **Browse** button to search for the credential)

Click **Next**

+++<hr>++++++</hr>+++

### **Preview**

Press the **Finish** button.

The **Successful output" should look like the following.
+++<img src="https://github.com/HichamMourad/awsinfravis25/blob/master/images/ping_output.png?raw=true" style="width:600px;margin-left:0px">++++++</img>+++

+++<hr>++++++</hr>+++


The ad-hoc PING test will setup an Ansible +++<a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/ping_module.html" target="_new">+++ping+++</a>+++ task which will verify we have SSH connectivity between our control node and the two RHEL ec2 instances running on AWS.

‚úÖ Next Challenge
===
Press the `Check` button below to go to the next challenge once you've completed the task.

üêõ Encountered an issue?
====

If you have encountered an issue or have noticed something not quite right, please [open an issue](https://github.com/ansible/instruqt/issues/new?title=Issue+with+Ansible+Hybrid+Cloud+Automation+-+Infrastructure+visibility+(aap2.5)&assignees=hichammourad).+++</tr>++++++</table>++++++</tr>++++++</table>++++++</tr>++++++</tr>++++++</table>++++++</tr>++++++</tr>++++++</table>+++
