üëã Introduction ===
+
==== Estimated time to complete: _20 minutes_<p>
+
Welcome to the second challenge.
For this challenge we will learn how to retrieve public cloud information with a job template.

Login to Ansible Automation Platform with the following credentials

[cols=2*]
|===
| username:
| `admin`

| password:
| `ansible123!`
|===

= ‚òëÔ∏è Task 1 - Create a Job Template

To create a *Job Template* we need three main components:

. An *inventory* to run the automation against
. A *credential* to access the API
. A *project* to synchronize playbooks from.

Click the *Templates* link in the left navigation menu underneath *Automation Execution \-> Templates*

* Now click on `+ Create Template` then scroll down and click  `Create job template` image:https://github.com/HichamMourad/awsinfravis25/blob/master/images/create_templates.png?raw=true[,600] Fill out the following fields:

'''+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Name+++</td>++++++<td>+++Retrieve VPC info+++</td>+++
+++<tr>++++++<td>+++Job Type+++</td>++++++<td>+++Run+++</td>+++
+++<tr>++++++<td>+++Inventory+++</td>++++++<td>+++Demo Inventory+++</td>+++
+++<tr>++++++<td>+++Project+++</td>++++++<td>+++AWS Demos Project+++</td>+++
+++<tr>++++++<td>+++Execution Environment+++</td>++++++<td>+++AWS Execution Environment+++</td>+++
+++<tr>++++++<td>+++Playbook+++</td>++++++<td>++++++<code>+++playbooks/info_vpcs.yml+++</code>++++++</td>+++
+++<tr>++++++<td>+++Credentials+++</td>++++++<td>++++++<code>+++AWS_Credential+++</code>++++++</td>+++
</table>
+++<hr>++++++</hr>+++

* If you have trouble finding the `AWS_Credential` make sure you are looking under the Credential Type `Amazon Web Services`

Click the blue **Create Job Template** button to **save** the job template.


The project we are loading Ansible Playbooks from can be found here [https://github.com/ansible-cloud/aws_demos](https://github.com/ansible-cloud/aws_demos)


‚òëÔ∏è Task 2 - Launch the Job Template
===

Click the **Templates** link in the left navigation menu underneath **Automation Execution**.  You will see your `Retrieve VPC info` job template.

Click the rocket symbol to `Launch Template`.
+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/launch_job.png?raw=true" style="width:80px;margin-left:0px">++++++</img>+++

This playbook has two tasks. The first task `amazon.aws.ec2_vpc_net_info` will retrieve structured data for VPCs (by default this will use `us-east-1`).  The 2nd task will use the `ansible.builtin.debug` module to print this out to the terminal which we can see in the automation controller job window.

Click on the `Print vpc info to terminal` task output, then click on the `Data` tab, then click on the `JSON` tab.  You will see the structured data retrieved for VPCs on us-east-1.  We have pre-configured one (1) VPC in this region.

+++<img src="https://github.com/HichamMourad/awsinfravis25/blob/master/images/vpc_output.png?raw=true" style="width:400px;margin-left:0px">++++++</img>+++

This structured data can be used in our future challenge to crate dynamic documentation.


‚òëÔ∏è Task 3 - Create a Survey
===

Click the **Templates** link in the left navigation menu underneath **Automation Execution**.  You will see your `Retrieve VPC info` job template.
* Click the `Retrieve VPC info` link to open the job template.
* Now, click the `Survey` tab at the top of the job template.

+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/survey_tab.png?raw=true" style="width:400px;margin-left:0px">++++++</img>+++

* Click the blue `Create survey question` button.

Fill out the following values:
+++<hr>++++++</hr>+++

+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Question+++</td>++++++<td>+++What AWS region?+++</td>+++
+++<tr>++++++<td>+++Description+++</td>++++++<td>+++choose the AWS region you want+++</td>+++
+++<tr>++++++<td>+++Answer variable name+++</td>++++++<td>++++++<code>+++ec2_region+++</code>++++++</td>+++
+++<tr>++++++<td>+++Answer type+++</td>++++++<td>+++Multiple Choice (single select)+++</td>+++
+++<tr>++++++<td>+++Required+++</td>++++++<td>+++‚òëÔ∏è+++</td>+++
+++<tr>++++++<td>+++Multiple Choice Options+++</td>++++++<td>++++++<ul>++++++<li>+++us-east-1+++</li>++++++<li>+++us-east-2+++</li>++++++<li>+++eu-central-1+++</li>++++++</ul>++++++</td>+++
</table>

Click the `Default option` radio button next to `us-east-1`

Click the blue  **Create survey question** to **Save** the Survey.

+++<hr>++++++</hr>+++

Make sure to click the toggle button to enabled the survey.

+++<img src="https://github.com/HichamMourad/awsinfravis25/blob/master/images/survey_toggle.png?raw=true" style="width:600px;margin-left:0px">++++++</img>+++

Click the `Launch template` button in the top right to launch the job again.

+++<hr>++++++</hr>+++

This time you will see a survey prompt:

+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/what_region.png?raw=true" style="width:200px;margin-left:0px">++++++</img>+++

Surveys set extra variables for the playbook in a user-friendly question and answer way.  This allows you to abstract complexity using question and answer format.

Feel free to choose another region (other than us-east-1) and verify the output is different from us-east-1.


‚òëÔ∏è Task 4 - Create more job templates
===

There are two more job templates similar to the `Retrieve VPC info` one we can create for EC2 instances and IGW (internet gateways) for AWS.  Create the following two job templates:


+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Name+++</td>++++++<td>++++++<b>+++Retrieve EC2 instances info+++</b>++++++</td>+++
+++<tr>++++++<td>+++Job Type+++</td>++++++<td>+++Run+++</td>+++
+++<tr>++++++<td>+++Inventory+++</td>++++++<td>+++Demo Inventory+++</td>+++
+++<tr>++++++<td>+++Project+++</td>++++++<td>+++AWS Demos Project+++</td>+++
+++<tr>++++++<td>+++Execution Environment+++</td>++++++<td>+++AWS Execution Environment+++</td>+++
+++<tr>++++++<td>+++Playbook+++</td>++++++<td>++++++<code>+++playbooks/info_instances.yml+++</code>++++++</td>+++
+++<tr>++++++<td>+++Credentials+++</td>++++++<td>++++++<code>+++AWS_Credential+++</code>++++++</td>+++
</table>

+++<hr>++++++</hr>+++

+++<table>++++++<tr>++++++<td>+++Name+++</td>++++++<td>++++++<b>+++Retrieve IGWs info+++</b>++++++</td>+++
+++<tr>++++++<td>+++Job Type+++</td>++++++<td>+++Run+++</td>+++
+++<tr>++++++<td>+++Inventory+++</td>++++++<td>+++Demo Inventory+++</td>+++
+++<tr>++++++<td>+++Project+++</td>++++++<td>+++AWS Demos Project+++</td>+++
+++<tr>++++++<td>+++Execution Environment+++</td>++++++<td>+++AWS Execution Environment+++</td>+++
+++<tr>++++++<td>+++Playbook+++</td>++++++<td>++++++<code>+++playbooks/info_igws.yml+++</code>++++++</td>+++
+++<tr>++++++<td>+++Credentials+++</td>++++++<td>++++++<code>+++AWS_Credential+++</code>++++++</td>+++
</table>

These will provide structured data for EC2 instances and IGWs respectively.  Try adding a survey to them as well!

+++<hr>++++++</hr>+++

OPTIONAL - Going even further\... what if we combined all of these?  Create one more job template:

+++<table>++++++<tr>++++++<td>+++Name+++</td>++++++<td>++++++<b>+++Retrieve Combined info+++</b>++++++</td>+++
+++<tr>++++++<td>+++Job Type+++</td>++++++<td>+++Run+++</td>+++
+++<tr>++++++<td>+++Inventory+++</td>++++++<td>+++Demo Inventory+++</td>+++
+++<tr>++++++<td>+++Project+++</td>++++++<td>+++AWS Demos Project+++</td>+++
+++<tr>++++++<td>+++Execution Environment+++</td>++++++<td>+++AWS Execution Environment+++</td>+++
+++<tr>++++++<td>+++Playbook+++</td>++++++<td>++++++<code>+++playbooks/info_combined.yml+++</code>++++++</td>+++
+++<tr>++++++<td>+++Credentials+++</td>++++++<td>++++++<code>+++AWS_Credential+++</code>++++++</td>+++
</table>

This last one may look formatted incorrectly inside automation controller but what it is actually doing is combining the structured data from AWS VPCs, EC2 instances and IGWs to create infrastructure awareness for the cloud administrator.  This is what the standard out will look like (non-JSON):

![Image of combined output](https://github.com/IPvSean/pictures_for_github/blob/master/cloud_awareness.png?raw=true)

A cloud operator can quickly see how many instances are online in that region, and what VPCs they are on, as well as the associated IGW.  This is combining several informational modules which correspond to multiple AWS boto3 API calls.  In the above image the cloud operator can quickly see there are multiple VPCs that can be retired because they are not in use.

‚úÖ Next Challenge
===
Press the `Check` button below to go to the next challenge once you've completed the task.

üêõ Encountered an issue?
====

If you have encountered an issue or have noticed something not quite right, please [open an issue](https://github.com/ansible/instruqt/issues/new?title=Issue+with+Ansible+Hybrid+Cloud+Automation+-+Infrastructure+visibility+(aap2.5)&assignees=hichammourad).+++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</table>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</table>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</table>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</table>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</table>+++
